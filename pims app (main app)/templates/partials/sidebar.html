{% load static %}

<!-- Sidebar Navigation -->
{% if user.is_authenticated %}
<nav class="sidebar d-none d-lg-block" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header p-3 border-bottom border-white border-opacity-15">
        <div class="text-center">
            <h5 class="text-white fw-bold mb-1">Bangladesh Parliament</h5>
            <small class="text-white-75">Secretariat</small>
        </div>
    </div>
    
    <!-- Sidebar Menu -->
    <div class="sidebar-menu flex-grow-1 py-3">
        <!-- Dashboard -->
        <div class="nav-section mb-3">
            <a href="{% url 'dashboard' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-speedometer2 me-3"></i>Dashboard
            </a>
        </div>
        
        <!-- Core Management -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Management</h6>
            
            <a href="{% url 'users:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-people me-3"></i>Users
            </a>
            
            <a href="{% url 'locations:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-geo-alt me-3"></i>Locations
            </a>
            
            <!-- Devices with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'devices:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-laptop me-3"></i>
                    <span class="flex-grow-1">Devices</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="devices" aria-hidden="true">
                    <a href="{% url 'devices:category_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tag me-2"></i>Categories
                    </a>
                    <a href="{% url 'devices:subcategory_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tags me-2"></i>Subcategories
                    </a>
                    <a href="{% url 'devices:warranty_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-shield-check me-2"></i>Warranties
                    </a>
                </div>
            </div>
            
            <a href="{% url 'vendors:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-building me-3"></i>Vendors
            </a>
        </div>
        
        <!-- Operations -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Operations</h6>
            
            <!-- Assignments with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'assignments:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-arrow-left-right me-3"></i>
                    <span class="flex-grow-1">Assignments</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="assignments" aria-hidden="true">
                    <a href="{% url 'assignments:active' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Active
                    </a>
                    <a href="{% url 'assignments:returned' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-arrow-return-left me-2"></i>Returned
                    </a>
                    <a href="{% url 'assignments:overdue' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-exclamation-triangle me-2"></i>Overdue
                    </a>
                </div>
            </div>
            
            <!-- Maintenance with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'maintenance:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-tools me-3"></i>
                    <span class="flex-grow-1">Maintenance</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="maintenance" aria-hidden="true">
                    <a href="{% url 'maintenance:scheduled' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-calendar-event me-2"></i>Scheduled
                    </a>
                    <a href="{% url 'maintenance:in_progress' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-gear me-2"></i>In Progress
                    </a>
                    <a href="{% url 'maintenance:completed' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check2-all me-2"></i>Completed
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Reports -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Reports</h6>
            
            <!-- Reports with persistent submenu -->
            <div class="nav-item">
                <a href="#" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-bar-chart me-3"></i>
                    <span class="flex-grow-1">Reports</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="reports" aria-hidden="true">
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-graph-up me-2"></i>Analytics
                    </a>
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-file-earmark-text me-2"></i>Inventory
                    </a>
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-calendar3 me-2"></i>Monthly
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sidebar Footer - Fixed at bottom -->
    <div class="sidebar-footer">
        <div class="dropdown">
            <a href="#" 
               class="nav-link dropdown-toggle d-flex align-items-center text-white-75" 
               data-bs-toggle="dropdown" 
               aria-expanded="false">
                <div class="flex-shrink-0">
                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 32px; height: 32px;">
                        <i class="bi bi-person-fill text-dark"></i>
                    </div>
                </div>
                <div class="flex-grow-1 ms-2">
                    <div class="fw-semibold text-white small">{{ user.get_full_name|default:user.username }}</div>
                    <div class="text-white-50 small">{{ user.email }}</div>
                </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark" 
                style="box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.25); 
                       border: 1px solid rgba(255, 255, 255, 0.1); 
                       margin-bottom: 10px;">
                <li>
                    <a class="dropdown-item py-2 px-3 rounded-2" href="{% url 'users:profile' %}">
                        <i class="bi bi-person-gear me-2"></i>My Profile
                    </a>
                </li>
                <li>
                    <a class="dropdown-item py-2 px-3 rounded-2" href="#">
                        <i class="bi bi-gear me-2"></i>Settings
                    </a>
                </li>
                <li>
                    <a class="dropdown-item py-2 px-3 rounded-2" href="#">
                        <i class="bi bi-question-circle me-2"></i>Help & Support
                    </a>
                </li>
                <li><hr class="dropdown-divider my-2"></li>
                <li>
                    <form method="post" action="{% url 'admin:logout' %}" class="d-inline w-100">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item text-danger py-2 px-3 rounded-2 w-100 text-start border-0 bg-transparent">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Mobile Sidebar Overlay -->
<div class="sidebar-overlay d-lg-none" id="sidebarOverlay"></div>

<!-- Mobile Sidebar -->
<nav class="sidebar sidebar-mobile d-lg-none" id="mobileSidebar">
    <!-- Mobile Sidebar Header -->
    <div class="sidebar-header p-3 border-bottom border-white border-opacity-15 d-flex justify-content-between align-items-center">
        <div>
            <h6 class="text-white fw-bold mb-0">Bangladesh Parliament</h6>
            <small class="text-white-75">Secretariat</small>
        </div>
        <button type="button" class="btn btn-sm btn-outline-light" id="closeMobileSidebar">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    
    <!-- Mobile Sidebar Menu (same structure as desktop) -->
    <div class="sidebar-menu flex-grow-1 py-3">
        <!-- Dashboard -->
        <div class="nav-section mb-3">
            <a href="{% url 'dashboard' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-speedometer2 me-3"></i>Dashboard
            </a>
        </div>
        
        <!-- Core Management -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Management</h6>
            
            <a href="{% url 'users:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-people me-3"></i>Users
            </a>
            
            <a href="{% url 'locations:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-geo-alt me-3"></i>Locations
            </a>
            
            <!-- Mobile Devices with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'devices:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-laptop me-3"></i>
                    <span class="flex-grow-1">Devices</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="devices-mobile" aria-hidden="true">
                    <a href="{% url 'devices:category_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tag me-2"></i>Categories
                    </a>
                    <a href="{% url 'devices:subcategory_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tags me-2"></i>Subcategories
                    </a>
                    <a href="{% url 'devices:warranty_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-shield-check me-2"></i>Warranties
                    </a>
                </div>
            </div>
            
            <a href="{% url 'vendors:list' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-building me-3"></i>Vendors
            </a>
        </div>
        
        <!-- Operations -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Operations</h6>
            
            <!-- Mobile Assignments with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'assignments:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-arrow-left-right me-3"></i>
                    <span class="flex-grow-1">Assignments</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="assignments-mobile" aria-hidden="true">
                    <a href="{% url 'assignments:active' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Active
                    </a>
                    <a href="{% url 'assignments:returned' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-arrow-return-left me-2"></i>Returned
                    </a>
                    <a href="{% url 'assignments:overdue' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-exclamation-triangle me-2"></i>Overdue
                    </a>
                </div>
            </div>
            
            <!-- Mobile Maintenance with persistent submenu -->
            <div class="nav-item">
                <a href="{% url 'maintenance:list' %}" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-tools me-3"></i>
                    <span class="flex-grow-1">Maintenance</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="maintenance-mobile" aria-hidden="true">
                    <a href="{% url 'maintenance:scheduled' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-calendar-event me-2"></i>Scheduled
                    </a>
                    <a href="{% url 'maintenance:in_progress' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-gear me-2"></i>In Progress
                    </a>
                    <a href="{% url 'maintenance:completed' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check2-all me-2"></i>Completed
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Reports -->
        <div class="nav-section mb-3">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Reports</h6>
            
            <!-- Mobile Reports with persistent submenu -->
            <div class="nav-item">
                <a href="#" 
                   class="nav-link nav-link-toggle text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover"
                   data-toggle="submenu"
                   aria-expanded="false">
                    <i class="bi bi-bar-chart me-3"></i>
                    <span class="flex-grow-1">Reports</span>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </a>
                <div class="submenu" data-submenu="reports-mobile" aria-hidden="true">
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-graph-up me-2"></i>Analytics
                    </a>
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-file-earmark-text me-2"></i>Inventory
                    </a>
                    <a href="#" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-calendar3 me-2"></i>Monthly
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Sidebar Footer -->
    <div class="sidebar-footer">
        <div class="d-flex align-items-center mb-3">
            <div class="flex-shrink-0">
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" 
                     style="width: 40px; height: 40px;">
                    <i class="bi bi-person-fill text-dark"></i>
                </div>
            </div>
            <div class="flex-grow-1 ms-3">
                <div class="fw-semibold text-white">{{ user.get_full_name|default:user.username }}</div>
                <div class="text-white-50 small">{{ user.email }}</div>
            </div>
        </div>
        
        <div class="d-grid gap-2">
            <a href="{% url 'users:profile' %}" class="btn btn-outline-light btn-sm">
                <i class="bi bi-person-gear me-1"></i>Profile
            </a>
            <form method="post" action="{% url 'admin:logout' %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </button>
            </form>
        </div>
    </div>
</nav>

<style>
/* Additional Mobile Sidebar Styles */
.sidebar-mobile {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 280px;
    z-index: 1045;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
}

.sidebar-mobile.show {
    transform: translateX(0);
}

.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
}

/* Enhanced dropdown menu for sidebar footer */
.sidebar-footer .dropdown-menu {
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(10px);
}

.sidebar-footer .dropdown-item {
    color: rgba(255, 255, 255, 0.8);
    transition: all 0.2s ease;
}

.sidebar-footer .dropdown-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.95);
}

.sidebar-footer .dropdown-item.text-danger:hover {
    background-color: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .sidebar-mobile {
        width: 260px;
    }
}

@media (max-width: 480px) {
    .sidebar-mobile {
        width: 100vw;
    }
}
</style>

<script>
// Additional JavaScript for mobile sidebar
document.addEventListener('DOMContentLoaded', function() {
    const sidebarToggle = document.getElementById('sidebarToggle');
    const mobileSidebar = document.getElementById('mobileSidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const closeMobileSidebar = document.getElementById('closeMobileSidebar');
    
    // Show mobile sidebar
    if (sidebarToggle && mobileSidebar && sidebarOverlay) {
        sidebarToggle.addEventListener('click', function(e) {
            e.preventDefault();
            mobileSidebar.classList.add('show');
            sidebarOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        });
    }
    
    // Hide mobile sidebar
    function hideMobileSidebar() {
        if (mobileSidebar && sidebarOverlay) {
            mobileSidebar.classList.remove('show');
            sidebarOverlay.classList.remove('show');
            document.body.style.overflow = '';
        }
    }
    
    // Close button
    if (closeMobileSidebar) {
        closeMobileSidebar.addEventListener('click', hideMobileSidebar);
    }
    
    // Overlay click
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', hideMobileSidebar);
    }
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileSidebar && mobileSidebar.classList.contains('show')) {
            hideMobileSidebar();
        }
    });
    
    // Close on window resize if mobile sidebar is open
    window.addEventListener('resize', function() {
        if (window.innerWidth >= 992 && mobileSidebar && mobileSidebar.classList.contains('show')) {
            hideMobileSidebar();
        }
    });
});
</script>
{% endif %}