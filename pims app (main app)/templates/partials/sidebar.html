{% load static %}

<!-- Sidebar Navigation -->
{% if user.is_authenticated %}
<nav class="sidebar d-none d-lg-block" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header p-3 border-bottom border-white border-opacity-15">
        <div class="text-center">
            <h5 class="text-white fw-bold mb-1">Bangladesh Parliament</h5>
            <small class="text-white-75">Secretariat - PIMS</small>
        </div>
    </div>
    
    <!-- Sidebar Menu -->
    <div class="sidebar-menu flex-grow-1 py-3">
        <!-- Dashboard -->
        <div class="nav-section mb-3">
            <a href="{% url 'dashboard' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-speedometer2 me-3"></i>Dashboard
            </a>
        </div>
        
        <!-- Core Management -->
        <div class="nav-section mb-4">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Management</h6>
            
            <!-- Users Management -->
            <div class="nav-item">
                <a href="{% url 'users:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-people me-3"></i>
                    <span class="flex-grow-1">Users</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'users:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-person-lines-fill me-2"></i>All Users
                    </a>
                    <a href="{% url 'users:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-person-plus me-2"></i>Add User
                    </a>
                    <a href="/admin/auth/group/" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-shield-check me-2"></i>Roles & Permissions
                    </a>
                    <a href="{% url 'users:search' %}?status=active" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-person-check me-2"></i>Active Users
                    </a>
                </div>
            </div>
            
            <!-- Locations Management -->
            <div class="nav-item">
                <a href="{% url 'locations:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-geo-alt me-3"></i>
                    <span class="flex-grow-1">Locations</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'locations:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-list-ul me-2"></i>All Locations
                    </a>
                    <a href="{% url 'locations:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-plus-circle me-2"></i>Add Location
                    </a>
                    <a href="{% url 'locations:building_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-building me-2"></i>Buildings
                    </a>
                    <a href="{% url 'locations:office_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-door-open me-2"></i>Offices
                    </a>
                    <a href="{% url 'locations:map' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-map me-2"></i>Location Map
                    </a>
                </div>
            </div>
            
            <!-- Devices Management -->
            <div class="nav-item">
                <a href="{% url 'devices:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-laptop me-3"></i>
                    <span class="flex-grow-1">Devices</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'devices:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-list-ul me-2"></i>All Devices
                    </a>
                    <a href="{% url 'devices:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-plus-circle me-2"></i>Add Device
                    </a>
                    <a href="{% url 'devices:search' %}?status=available" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Available
                    </a>
                    <a href="{% url 'devices:search' %}?status=assigned" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-person-check me-2"></i>Assigned
                    </a>
                    <a href="{% url 'devices:search' %}?status=maintenance" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tools me-2"></i>In Maintenance
                    </a>
                    <a href="{% url 'devices:category_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-tags me-2"></i>Categories
                    </a>
                    <a href="{% url 'devices:qr_list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-qr-code-scan me-2"></i>QR Scanner
                    </a>
                    <a href="{% url 'devices:reports' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-graph-up me-2"></i>Reports
                    </a>
                </div>
            </div>
            
            <!-- Vendors Management -->
            <div class="nav-item">
                <a href="{% url 'vendors:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-building me-3"></i>
                    <span class="flex-grow-1">Vendors</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'vendors:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-list-ul me-2"></i>All Vendors
                    </a>
                    <a href="{% url 'vendors:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-plus-circle me-2"></i>Add Vendor
                    </a>
                    <a href="{% url 'vendors:search' %}?status=active" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Active Vendors
                    </a>
                    <a href="{% url 'vendors:reports' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-graph-up me-2"></i>Reports
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Operations -->
        <div class="nav-section mb-4">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Operations</h6>
            
            <!-- Assignments Management -->
            <div class="nav-item">
                <a href="{% url 'assignments:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-arrow-left-right me-3"></i>
                    <span class="flex-grow-1">Assignments</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'assignments:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-list-ul me-2"></i>All Assignments
                    </a>
                    <a href="{% url 'assignments:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-plus-circle me-2"></i>New Assignment
                    </a>
                    <a href="{% url 'assignments:search' %}?status=active" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Active
                    </a>
                    <a href="{% url 'assignments:search' %}?status=returned" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-arrow-return-left me-2"></i>Returned
                    </a>
                    <a href="{% url 'assignments:search' %}?status=overdue" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-exclamation-triangle me-2"></i>Overdue
                    </a>
                    <a href="{% url 'assignments:reports' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-person-lines-fill me-2"></i>By User
                    </a>
                    <a href="{% url 'assignments:reports' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-geo-alt me-2"></i>By Location
                    </a>
                </div>
            </div>
            
            <!-- Maintenance Management -->
            <div class="nav-item">
                <a href="{% url 'maintenance:list' %}" class="nav-link text-white-75 py-2 px-3 d-flex align-items-center rounded mx-2 transition-hover">
                    <i class="bi bi-tools me-3"></i>
                    <span class="flex-grow-1">Maintenance</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="submenu ms-4">
                    <a href="{% url 'maintenance:list' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-list-ul me-2"></i>All Maintenance
                    </a>
                    <a href="{% url 'maintenance:create' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-plus-circle me-2"></i>Schedule Maintenance
                    </a>
                    <a href="{% url 'maintenance:scheduled' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-calendar-check me-2"></i>Scheduled
                    </a>
                    <a href="{% url 'maintenance:in_progress' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-gear me-2"></i>In Progress
                    </a>
                    <a href="{% url 'maintenance:completed' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-check-circle me-2"></i>Completed
                    </a>
                    <a href="{% url 'maintenance:overdue' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-exclamation-triangle me-2"></i>Overdue
                    </a>
                    <a href="{% url 'maintenance:schedule_recurring' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-arrow-repeat me-2"></i>Recurring Schedule
                    </a>
                    <a href="{% url 'maintenance:reports_home' %}" class="nav-link text-white-50 py-1 px-3 d-block rounded small transition-hover">
                        <i class="bi bi-graph-up me-2"></i>Reports
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Reports & Analytics -->
        <div class="nav-section mb-4">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Analytics</h6>
            
            <a href="#" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-graph-up me-3"></i>Analytics Dashboard
            </a>
            
            <a href="#" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-file-earmark-text me-3"></i>System Reports
            </a>
            
            <a href="#" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-journal-text me-3"></i>Audit Logs
            </a>
            
            <a href="#" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-bell me-3"></i>Notifications
            </a>
        </div>
        
        <!-- System Administration -->
        {% if user.is_staff or user.is_superuser %}
        <div class="nav-section mb-4">
            <h6 class="nav-header text-white-50 px-3 mb-2 small fw-semibold text-uppercase">Administration</h6>
            
            <a href="#" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-gear me-3"></i>System Settings
            </a>
            
            <a href="{% url 'devices:export_excel' %}" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover">
                <i class="bi bi-cloud-download me-3"></i>Backup & Export
            </a>
            
            <a href="/admin/" class="nav-link text-white-75 py-2 px-3 d-block rounded mx-2 transition-hover" target="_blank">
                <i class="bi bi-file-text me-3"></i>System Logs
            </a>
        </div>
        {% endif %}
    </div>
</nav>

<!-- Mobile Sidebar Overlay (Bootstrap breakpoint compatibility) -->
<div class="sidebar-overlay d-lg-none" id="sidebarOverlay"></div>

<!-- Custom Sidebar Styles -->
<style>
/* Sidebar Base Styles - PIMS Design Rules: Flat design with high contrast, teal color scheme */
.sidebar {
    position: fixed;
    top: 56px;
    left: 0;
    height: calc(100vh - 56px);
    width: 280px;
    background: linear-gradient(2deg, rgb(25, 27, 28) 0%, rgb(57, 61, 59) 50%, rgb(35, 37, 39) 100%);
    z-index: 1020;
    overflow-y: auto;
    overflow-x: hidden;
    transition: transform 0.3s ease;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
}

/* Mobile responsive sidebar */
@media (max-width: 1023.98px) {
    .sidebar {
        transform: translateX(-100%);
        display: block !important;
    }
    
    .sidebar.show {
        transform: translateX(0);
    }
}

/* Sidebar Header - High contrast design */
.sidebar-header {
    background: rgba(0, 0, 0, 0.15);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.sidebar-header h5 {
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
    font-weight: 700;
}

.sidebar-header small {
    font-size: 0.75rem;
    opacity: 0.9;
}

/* Scrollbar styling for better UX */
.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
}

.sidebar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Navigation Sections */
.nav-section {
    position: relative;
}

/* Section Headers - Flat design with clear typography */
.nav-header {
    font-size: 0.75rem;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.7) !important;
}

/* Navigation Links - High contrast, readable design */
.sidebar .nav-link {
    color: rgba(255, 255, 255, 0.85) !important;
    transition: all 0.25s ease;
    border-radius: 8px;
    margin: 2px 0;
    font-weight: 500;
    font-size: 0.9rem;
    border: 1px solid transparent;
    position: relative;
}

.sidebar .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.15);
    color: white !important;
    transform: translateX(3px);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.sidebar .nav-link.active {
    background-color: rgba(255, 255, 255, 0.2);
    color: white !important;
    border-color: rgba(255, 255, 255, 0.3);
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Submenu Styles - Flat design with clear hierarchy */
.submenu {
    display: none;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 6px;
    margin: 0.5rem 0;
    padding: 0.25rem 0;
    border-left: 2px solid rgba(255, 255, 255, 0.2);
}

.submenu.show {
    display: block;
    animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.submenu .nav-link {
    font-size: 0.8rem;
    padding: 0.4rem 1rem !important;
    color: rgba(255, 255, 255, 0.7) !important;
    margin: 1px 0;
}

.submenu .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9) !important;
    transform: translateX(2px);
}

.submenu .nav-link.active {
    background-color: rgba(255, 255, 255, 0.15);
    color: white !important;
    font-weight: 600;
}

/* Chevron rotation for expanded items */
.nav-link[aria-expanded="true"] .bi-chevron-down {
    transform: rotate(180deg);
}

/* Transition effects for better UX */
.transition-hover {
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Mobile sidebar overlay */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1019;
    display: none;
}

.sidebar.show ~ .sidebar-overlay {
    display: block;
}

/* Icons spacing and alignment */
.sidebar .nav-link i {
    width: 1.2rem;
    text-align: center;
    font-size: 1rem;
}

/* Responsive adjustments */
@media (max-width: 575.98px) {
    .sidebar {
        width: 100%;
    }
}

/* Badge styles for notifications */
.nav-badge {
    background: #f97316;
    color: white;
    font-size: 0.6rem;
    padding: 0.2rem 0.4rem;
    border-radius: 10px;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
}

/* High contrast focus states for accessibility */
.sidebar .nav-link:focus {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    outline-offset: 2px;
}

/* Bangladesh location context - Dhaka Parliament theme */
.sidebar-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #006a4e 0%, #f42a41 50%, #006a4e 100%);
}
</style>

<!-- Sidebar JavaScript Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize sidebar functionality
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    // Toggle sidebar on mobile
    if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function(e) {
            e.preventDefault();
            sidebar.classList.toggle('show');
            
            if (sidebarOverlay) {
                sidebarOverlay.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
            }
        });
    }
    
    // Close sidebar when clicking overlay
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('show');
            this.style.display = 'none';
        });
    }
    
    // Submenu toggle functionality
    const menuItems = document.querySelectorAll('.sidebar .nav-item > .nav-link');
    
    menuItems.forEach(function(link) {
        const parentItem = link.closest('.nav-item');
        const submenu = parentItem.querySelector('.submenu');
        
        if (submenu) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Toggle current submenu
                const isOpen = submenu.classList.contains('show');
                
                if (isOpen) {
                    submenu.classList.remove('show');
                    link.setAttribute('aria-expanded', 'false');
                } else {
                    // Close other submenus (accordion behavior)
                    document.querySelectorAll('.submenu.show').forEach(function(openSubmenu) {
                        if (openSubmenu !== submenu) {
                            openSubmenu.classList.remove('show');
                            const openLink = openSubmenu.closest('.nav-item').querySelector('.nav-link');
                            openLink.setAttribute('aria-expanded', 'false');
                        }
                    });
                    
                    // Open current submenu
                    submenu.classList.add('show');
                    link.setAttribute('aria-expanded', 'true');
                }
            });
        }
    });
    
    // Close sidebar on window resize if mobile
    window.addEventListener('resize', function() {
        if (window.innerWidth >= 1024) {
            sidebar.classList.remove('show');
            if (sidebarOverlay) {
                sidebarOverlay.style.display = 'none';
            }
        }
    });
    
    // Keyboard navigation support
    sidebar.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            sidebar.classList.remove('show');
            if (sidebarOverlay) {
                sidebarOverlay.style.display = 'none';
            }
            if (sidebarToggle) {
                sidebarToggle.focus();
            }
        }
    });
    
    // Set active states based on current URL
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.sidebar .nav-link[href]');
    
    navLinks.forEach(function(link) {
        const href = link.getAttribute('href');
        if (href && currentPath.startsWith(href) && href !== '/') {
            link.classList.add('active');
            
            // If it's a submenu item, also show the parent submenu
            const parentSubmenu = link.closest('.submenu');
            if (parentSubmenu) {
                parentSubmenu.classList.add('show');
                const parentLink = parentSubmenu.closest('.nav-item').querySelector('.nav-link');
                parentLink.setAttribute('aria-expanded', 'true');
            }
        }
    });
});
</script>

{% endif %}